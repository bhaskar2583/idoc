@model IBS.Controllers.SearchFiltrsResult

@{
    ViewBag.Title = "Index";
}
<div class="row col-md-12">
    <h2>
        Monthly Summary
    </h2>
    <hr />
</div>

<div class="row col-md-12 form-group" style="text-align:right;">
    <i class="fa fa-print" aria-hidden="true" style="font-size:35px;" id="iPrint"></i>
</div>

<div id="divData">
    <table id="tblData" class="table table-bordered table-hover responsive">
        <thead class="thead-dark lbl-grid-head">
           
        </thead>
        <tbody>

        </tbody>

    </table>

</div>
<script type="text/javascript">

    function print() {

        var divData = document.getElementById('divData').innerHTML;
        //var printWind = window.open('', 'Print-Window');
        //printWind.document.open();
        //printWind.document.write('<html><body onload="window.print()">' + divData.innerHTML + '</body></html>');
        //printWind.document.close();
        //setTimeout(function () { printWind.close(); }, 10);

        var printWindow = window.open('', '', 'height=400,width=400');
        printWindow.document.write('<html><head><title>Activity Summary</title>');
        printWindow.document.write('</head><body >');
        printWindow.document.write(divData);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
    }
   
    $(document).ready(function () {
        $("#iPrint").click(function () {
            print();
        });
        var host = window.location.origin;
        var apiPath = host + "/Reports";
        var isProd = false;
        if (isProd) {
            host = window.location.origin;
            apiPath = host + "/IBS/Reports";
        }

        var data = {};
        $.ajax({
            type: "POST",
            url: apiPath + "/MonthlySummary",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(data),
            success: function (data) {
                $("#tblData thead").empty();
                $("#tblData tbody").empty();

                $("#tblData thead").append(
                    "<tr>" +
                    "<th rowspan='2'>Coverage</th>" +
                    "<th rowspan='2'>Policy No</th>" +
                    "<th colspan='3'>Jan</th>" +
                    "<th colspan='3'>Feb</th>" +
                    "<th colspan='3'>Jan YTD</th>" +
                    "<th colspan='3'>Feb YTD</th>" +
                    "<th rowspan='2'>Budget Total</th>" +
                    "</tr>"
                );

                $("#tblData thead").append(
                    "<tr>" +
                    "<th>Act</th>" +
                    "<th>Bud</th>" +
                    "<th>VAR F/(U)</th>" +
                    "<th>Act</th>" +
                    "<th>Bud</th>" +
                    "<th>VAR F/(U)</th>" +
                    "<th>Act</th>" +
                    "<th>Bud</th>" +
                    "<th>VAR F/(U)</th>" +
                    "<th>Act</th>" +
                    "<th>Bud</th>" +
                    "<th>VAR F/(U)</th>" +
                    "</tr>"
                );
                var coverage = "";
                var JAT = 0;
                var JBT = 0;
                var JBF = 0;

                var FAT = 0;
                var FBT = 0;
                var FBF = 0;

                var YJAT = 0;
                var YJBT = 0;
                var YJBF = 0;

                var YFAT = 0;
                var YFBT = 0;
                var YFBF = 0;

                var TotalG = 0;
                for (var i = 0; i < data.MonthSummaryResult.length; i++) {//clients
                    var d = data.MonthSummaryResult[i];
                    
                    if (coverage!="" && coverage != d.CoverageName) {
                        $("#tblData tbody").append(
                            "<tr class='lbl - grid'>" +
                            "<td></td>" +
                            "<td></td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(TotalG).toFixed(2) + "</td>" +
                            "</tr>"
                        );

                        JAT = 0;
                        JBT = 0;
                        JBF = 0;

                        FAT = 0;
                        FBT = 0;
                        FBF = 0;

                        YJAT = 0;
                        YJBT = 0;
                        YJBF = 0;

                        YFAT = 0;
                        YFBT = 0;
                        YFBF = 0;

                        TotalG = 0;
                    }
                    coverage = d.CoverageName;
                    JAT = parseFloat(JAT) + parseFloat(d.JanA);
                    JBT = parseFloat(JBT) + parseFloat(d.JanA);
                    JBF = parseFloat(JBF) + parseFloat(d.JanA);

                    FAT = parseFloat(FAT) + parseFloat(d.FebA);
                    FBT = parseFloat(FBT) + parseFloat(d.FebB);
                    FBF = parseFloat(FBF) + parseFloat(d.FebF);

                    YJAT = parseFloat(YJAT) + parseFloat(d.JanYA);
                    YJBT = parseFloat(YJBT) + parseFloat(d.JanYB);
                    YJBF = parseFloat(YJBF) + parseFloat(d.JanYF);

                    YFAT = parseFloat(YFAT) + parseFloat(d.FebYA);
                    YFBT = parseFloat(YFBT) + parseFloat(d.FebYB);
                    YFBF = parseFloat(YFBF) + parseFloat(d.FebYF);

                    TotalG = parseFloat(TotalG) + parseFloat(d.FebYB);
                    
                    $("#tblData tbody").append(
                        "<tr class='lbl - grid'>" +
                        "<td>" + d.CoverageName + "</td>" +
                        "<td>" + d.PolicyNo + "</td>" +

                        "<td style='text-align:right'>" + parseFloat(d.JanA).toFixed(2) + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.JanB).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.JanF).toFixed(2)  + "</td>" +

                        "<td style='text-align:right'>" + parseFloat(d.FebA).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.FebB).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.FebF).toFixed(2)  + "</td>" +

                        "<td style='text-align:right'>" + parseFloat(d.JanYA).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.JanYB).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.JanYF).toFixed(2)  + "</td>" +

                        "<td style='text-align:right'>" + parseFloat(d.FebYA).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.FebYB).toFixed(2)  + "</td>" +
                        "<td style='text-align:right'>" + parseFloat(d.FebYF).toFixed(2)  + "</td>" +

                        "<td style='text-align:right'>" + parseFloat(d.Total).toFixed(2) + "</td>" +
                        "</tr>"
                    );

                    if (i == data.MonthSummaryResult.length - 1) {
                        $("#tblData tbody").append(
                            "<tr class='lbl - grid'>" +
                            "<td></td>" +
                            "<td></td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(JBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(FBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YJBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFAT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFBT).toFixed(2) + "</td>" +
                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(YFBF).toFixed(2) + "</td>" +

                            "<td style='text-align:right;font-weight:bold'>" + parseFloat(TotalG).toFixed(2) + "</td>" +
                            "</tr>"
                        );
                    }
                    
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log(errorThrown);
            }
        });
       
    });
</script>